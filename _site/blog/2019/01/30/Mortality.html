<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Probability of dying where I come from</title>

	<link rel="stylesheet" href="/css/main.css">
	<link rel="canonical" href="http://localhost:4000/blog/2019/01/30/Mortality">
	<link href='https://fonts.googleapis.com/css?family=Helvetica:400,300,500,800,600' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Helvetica:400,300' rel='stylesheet' type='text/css'>

</head> 


<body>
	<aside>
	<div class="container">
		<nav>
			<ul>
				 
				<li><a href="/home/">Home</a></li>
				  
				<li><a href="/about/">About</a></li>
				  
				<li><a href="/contact/">Contact</a></li>
				    
				<li><a href="/blog">Blog</a></li>
				      
				<li><a href="/jupyter">Jupyter</a></li>
				     
			</ul>
			</li>
			</ul>
		</nav>
	</div>
</aside>

<header>
	<h1><a href="">Ganbatte ne!</a></h1>
</header>

	<main>
		<article>
			<h2>Probability of dying where I come from</h2>
<time>Jan 30, 2019</time>

<p>Let me just quickly load the data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span> <span class="c"># will need these to ask about age</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="n">widgets</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>    <span class="c"># will need this</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>                 
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>               <span class="c"># will need this</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>                 <span class="c"># will probably not need this, shall check</span>


</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">excel_file</span> <span class="o">=</span> <span class="s">'mort_data.xlsx'</span>
<span class="n">mort_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">excel_file</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mort_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Sex</th>
      <th>Lx</th>
      <th>Tx</th>
      <th>lx</th>
      <th>dx</th>
      <th>qx</th>
      <th>ex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>m</td>
      <td>68914.0</td>
      <td>481.0</td>
      <td>100000</td>
      <td>698</td>
      <td>0.006980</td>
      <td>71.96</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>m</td>
      <td>69476.0</td>
      <td>38.0</td>
      <td>99302</td>
      <td>54</td>
      <td>0.000544</td>
      <td>71.46</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>m</td>
      <td>69278.0</td>
      <td>21.0</td>
      <td>99248</td>
      <td>30</td>
      <td>0.000302</td>
      <td>70.50</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>m</td>
      <td>68570.0</td>
      <td>13.0</td>
      <td>99218</td>
      <td>19</td>
      <td>0.000191</td>
      <td>69.52</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>m</td>
      <td>69013.0</td>
      <td>5.0</td>
      <td>99199</td>
      <td>7</td>
      <td>0.000071</td>
      <td>68.54</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mort_data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div></div>

<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Sex</th>
      <th>Lx</th>
      <th>Tx</th>
      <th>lx</th>
      <th>dx</th>
      <th>qx</th>
      <th>ex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>197</th>
      <td>96</td>
      <td>f</td>
      <td>703.0</td>
      <td>221.0</td>
      <td>969</td>
      <td>446</td>
      <td>0.460268</td>
      <td>1.46</td>
    </tr>
    <tr>
      <th>198</th>
      <td>97</td>
      <td>f</td>
      <td>551.0</td>
      <td>199.0</td>
      <td>523</td>
      <td>267</td>
      <td>0.510516</td>
      <td>1.28</td>
    </tr>
    <tr>
      <th>199</th>
      <td>98</td>
      <td>f</td>
      <td>366.0</td>
      <td>129.0</td>
      <td>256</td>
      <td>145</td>
      <td>0.566406</td>
      <td>1.09</td>
    </tr>
    <tr>
      <th>200</th>
      <td>99</td>
      <td>f</td>
      <td>219.0</td>
      <td>76.0</td>
      <td>111</td>
      <td>70</td>
      <td>0.630631</td>
      <td>0.87</td>
    </tr>
    <tr>
      <th>201</th>
      <td>100</td>
      <td>f</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>41</td>
      <td>41</td>
      <td>1.000000</td>
      <td>0.50</td>
    </tr>
  </tbody>
</table>
</div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mort_data</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Index(['Age', 'Sex', 'Lx', 'Tx', 'lx', 'dx', 'qx', 'ex'], dtype='object')
</code></pre></div></div>

<p>The meanings of the column titles are the:</p>

<p>Lx: number of people of certain age #the data are coming from census<br />
Tx: number of people of ceratin age who died within last 12 months (?) #the data are coming from census
lx: number of living people of certain age (starting from 100000, smoothed)<br />
dx: number of people of certain age expected to die<br />
qx: probability of death (smoothed)<br />
ex: number of additional years that a person of certain age is expected to live (average)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Lx</span><span class="o">=</span><span class="n">mort_data</span><span class="p">[</span><span class="s">'Lx'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">age_raw</span><span class="o">=</span><span class="n">mort_data</span><span class="p">[</span><span class="s">'Age'</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">men_raw</span> <span class="o">=</span> <span class="n">Lx</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">Lx</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>
<span class="n">women</span> <span class="o">=</span> <span class="n">Lx</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Lx</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
<span class="n">men</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">men_raw</span><span class="p">]</span>
<span class="n">age</span><span class="o">=</span><span class="n">age_raw</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">Lx</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span>

</code></pre></div></div>

<p>This would be the population pyramid from my country:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s">"whitegrid"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s">"RdBu"</span><span class="p">)</span>  <span class="c">#, n_colors=4</span>

<span class="n">pm</span><span class="o">=</span><span class="n">bar_plot</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">barplot</span> <span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">men</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mort_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"men"</span><span class="p">)</span>
<span class="n">pw</span><span class="o">=</span><span class="n">bar_plot</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">barplot</span> <span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">women</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">mort_data</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"women"</span><span class="p">)</span>
<span class="n">pm</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s">"Population"</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s">"Age"</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">"Population Pyramid"</span><span class="p">)</span>

<span class="n">pm</span><span class="o">.</span><span class="nb">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s">'men           women'</span><span class="p">)</span>  <span class="c">#is this acceptable as a solution? pure trickery :)</span>


<span class="c"># pm.set(yticks=[-100000,-50000]) </span>
<span class="c"># pw.set(yticks=[50000,100000])</span>


<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
        <span class="n">label</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">pw</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">get_text</span><span class="p">())</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
        <span class="n">label</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/images/output_10_0.png" alt="png" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<p>So.  Back to the more important stuff.   <br />
What is your probability of dying then?</p>

<p>Choose your age on the slider. # still need to add the sex. For now you are female :).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_slider_variable</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">output_slider_variable</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c"># interact(f, x=40);  ---&gt; automatic slider is constructed with a range of [−10,+3×10]</span>
<span class="n">interact</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">IntSlider</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mi">40</span><span class="p">));</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interactive(children=(IntSlider(value=40, description='x'), Output()), _dom_classes=('widget-interact',))
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">output_slider_variable</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'40'
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">the_age</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">output_slider_variable</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>    <span class="c">#workaround, as for some reason, df.query won't work with anything but lists</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mort_data</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s">'Age == @the_age and Sex == "f"'</span><span class="p">)</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.0012031853823172534
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>


		</article>
		<footer>
	<p>It so turned out that no actual electro-swing was listened to while this page was being made. </p>
</footer>

	</main>
</body>

</html>
